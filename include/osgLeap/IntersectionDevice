/*
* Library osgLeap
* Copyright (C) 2013 Johannes Scholz/vtxtech. All rights reserved.
*
* This file is licensed under the GNU Lesser General Public License 3 (LGPLv3),
* but distributed WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
*
*/

#ifndef OSGLEAP_INTERSECTIONDEVICE_
#define OSGLEAP_INTERSECTIONDEVICE_ 1

//-- Project --//
#include <osgLeap/Export>
#include <osgLeap/IntersectionController>

//-- OSG: osg --//
#include <osgGA/Device>

namespace osgLeap {

    class OSGLEAP_EXPORT IntersectionDevice: public osgGA::Device
    {
    public:
        enum ClickMode {
            NONE = 0,
            TIMEBASED_MOUSECLICK = 1,
            SCREENTAP = 2
        };

        // Parameter-constructor with auto-update to screen resolution
        IntersectionDevice(ClickMode mode, int referenceTime, IntersectionController* intersectionController): osgGA::Device(),
            intersectionController_(intersectionController),
            mode_(mode),
            referenceTime_(referenceTime)
        {
            //OSG_NOTICE<<"IntersectionDevice::IntersectionDevice()"<<std::endl;
            setCapabilities(RECEIVE_EVENTS);
        }

        // Copy-constructor
        IntersectionDevice(const IntersectionDevice& nc, const osg::CopyOp& op): osgGA::Device(nc, op),
            intersectionController_(nc.intersectionController_), mode_(nc.mode_), referenceTime_(nc.referenceTime_)
        {
            //OSG_NOTICE<<"IntersectionDevice::IntersectionDevice(const IntersectionDevice& nc, const osg::CopyOp& op)"<<std::endl;
        }

        virtual bool checkEvents();
        virtual void sendEvent(const osgGA::GUIEventAdapter& ea);

    private:
        ClickMode mode_;
        int referenceTime_;
        osg::ref_ptr<IntersectionController> intersectionController_;

        void update();
    };

} // namespace osgLeap

#endif // OSGLEAP_INTERSECTIONDEVICE_
